<article class="doc-content">
  <!-- Hero Section -->
  <header class="doc-hero">
    <span class="doc-badge">Observability</span>
    <h1>
      <span class="doc-icon">üìä</span>
      Grafana Dashboards
    </h1>
    <p class="doc-subtitle">
      Pre-built Grafana dashboards for comprehensive monitoring of your Armature applications.
      Visualize HTTP metrics, authentication, caching, and background job processing in real-time.
    </p>
  </header>

  <!-- Features Grid -->
  <section class="doc-features">
    <div class="feature-card">
      <span class="feature-icon">üåê</span>
      <h3>Application Overview</h3>
      <p>Request rates, latency, error rates, and resource usage at a glance</p>
    </div>
    <div class="feature-card">
      <span class="feature-icon">üîê</span>
      <h3>Auth & Security</h3>
      <p>Login attempts, JWT tokens, rate limiting, and security events</p>
    </div>
    <div class="feature-card">
      <span class="feature-icon">‚ö°</span>
      <h3>Cache & Redis</h3>
      <p>Hit rates, connection pools, and operation latency</p>
    </div>
    <div class="feature-card">
      <span class="feature-icon">üìã</span>
      <h3>Queues & Jobs</h3>
      <p>Job throughput, queue depth, and cron task monitoring</p>
    </div>
  </section>

  <!-- Available Dashboards -->
  <section class="doc-section">
    <h2 id="dashboards">Available Dashboards</h2>
    <p>Armature provides four pre-built Grafana dashboards in <code>templates/grafana/</code>:</p>

    <div class="dashboard-grid">
      @for (dashboard of dashboards; track dashboard.file) {
        <div class="dashboard-card">
          <span class="dashboard-icon">{{ dashboard.icon }}</span>
          <div class="dashboard-info">
            <h4>{{ dashboard.name }}</h4>
            <code>{{ dashboard.file }}</code>
            <p>{{ dashboard.description }}</p>
          </div>
        </div>
      }
    </div>
  </section>

  <!-- Quick Start -->
  <section class="doc-section">
    <h2 id="quick-start">Quick Start</h2>
    <p>Get dashboards running in under 5 minutes:</p>

    <div class="doc-subsection">
      <h3>1. Enable Metrics in Your App</h3>
      <p>Ensure your Armature application exposes Prometheus metrics:</p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">rust</span>
          <span class="code-file">main.rs</span>
        </div>
        <pre><code><span class="keyword">use</span> armature::prelude::*;
<span class="keyword">use</span> armature_core::metrics::MetricsConfig;

<span class="attribute">#[tokio::main]</span>
<span class="keyword">async fn</span> <span class="function">main</span>() &#123;
    <span class="comment">// Enable Prometheus metrics endpoint</span>
    <span class="keyword">let</span> metrics = MetricsConfig::builder()
        .enabled(<span class="keyword">true</span>)
        .endpoint(<span class="string">"/metrics"</span>)
        .include_default_labels(<span class="keyword">true</span>)
        .build();

    <span class="keyword">let</span> app = Application::builder()
        .metrics(metrics)
        .build();

    app.listen(<span class="number">3000</span>).<span class="keyword">await</span>.unwrap();
&#125;

<span class="comment">// Metrics are now available at GET /metrics</span></code></pre>
      </div>
    </div>

    <div class="doc-subsection">
      <h3>2. Configure Prometheus</h3>
      <p>Add your Armature app as a scrape target:</p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">yaml</span>
          <span class="code-file">prometheus.yml</span>
        </div>
        <pre><code><span class="key">global</span>:
  <span class="key">scrape_interval</span>: <span class="string">15s</span>

<span class="key">scrape_configs</span>:
  - <span class="key">job_name</span>: <span class="string">'armature'</span>
    <span class="key">static_configs</span>:
      - <span class="key">targets</span>: [<span class="string">'your-app:3000'</span>]
    <span class="key">metrics_path</span>: <span class="string">'/metrics'</span>
    <span class="key">scrape_interval</span>: <span class="string">15s</span>

  <span class="comment"># For multiple instances</span>
  - <span class="key">job_name</span>: <span class="string">'armature-prod'</span>
    <span class="key">static_configs</span>:
      - <span class="key">targets</span>:
        - <span class="string">'api-1:3000'</span>
        - <span class="string">'api-2:3000'</span>
        - <span class="string">'api-3:3000'</span></code></pre>
      </div>
    </div>

    <div class="doc-subsection">
      <h3>3. Import Dashboards</h3>
      <p>Import the JSON files into Grafana:</p>
      <ol class="doc-steps">
        <li>Open Grafana ‚Üí <strong>Dashboards</strong> ‚Üí <strong>Import</strong></li>
        <li>Upload the JSON file from <code>templates/grafana/</code></li>
        <li>Select your Prometheus data source</li>
        <li>Click <strong>Import</strong></li>
      </ol>
    </div>
  </section>

  <!-- Application Overview Dashboard -->
  <section class="doc-section">
    <h2 id="overview-dashboard">Application Overview Dashboard</h2>
    <p>The main dashboard for monitoring application health:</p>

    <div class="doc-subsection">
      <h3>Top Row Stats</h3>
      <ul class="doc-list">
        <li><strong>Request Rate</strong> ‚Äî HTTP requests per second</li>
        <li><strong>P95 Latency</strong> ‚Äî 95th percentile response time (threshold: 100ms yellow, 500ms red)</li>
        <li><strong>Error Rate</strong> ‚Äî Percentage of 5xx responses (threshold: 1% yellow, 5% red)</li>
        <li><strong>Active Instances</strong> ‚Äî Number of running application instances</li>
        <li><strong>CPU Usage</strong> ‚Äî Average CPU utilization (threshold: 70% yellow, 90% red)</li>
        <li><strong>Memory Usage</strong> ‚Äî Average memory utilization (threshold: 70% yellow, 90% red)</li>
      </ul>
    </div>

    <div class="doc-subsection">
      <h3>HTTP Metrics Panels</h3>
      <ul class="doc-list">
        <li><strong>Request Rate by Method</strong> ‚Äî GET, POST, PUT, DELETE breakdown</li>
        <li><strong>Request Rate by Status</strong> ‚Äî 2xx (green), 4xx (yellow), 5xx (red)</li>
        <li><strong>Response Time Percentiles</strong> ‚Äî p50, p90, p95, p99 over time</li>
        <li><strong>Top 10 Endpoints</strong> ‚Äî Highest traffic endpoints</li>
      </ul>
    </div>

    <div class="doc-subsection">
      <h3>System Resources Panels</h3>
      <ul class="doc-list">
        <li><strong>CPU by Instance</strong> ‚Äî Per-instance CPU tracking</li>
        <li><strong>Memory by Instance</strong> ‚Äî Per-instance memory in bytes</li>
        <li><strong>Tokio Runtime Threads</strong> ‚Äî Worker and blocking thread counts</li>
        <li><strong>Active HTTP Connections</strong> ‚Äî Open connection count</li>
      </ul>
    </div>
  </section>

  <!-- Auth & Security Dashboard -->
  <section class="doc-section">
    <h2 id="auth-dashboard">Auth & Security Dashboard</h2>
    <p>Monitor authentication and security events:</p>

    <div class="metrics-grid">
      <div class="metric-category">
        <h4>üîë Authentication Metrics</h4>
        <ul>
          <li>Successful/Failed Logins (5-minute rolling)</li>
          <li>Active Sessions count</li>
          <li>JWT Tokens Issued rate</li>
          <li>JWT Validation Failures</li>
          <li>OAuth Callbacks by provider</li>
        </ul>
      </div>
      <div class="metric-category">
        <h4>üö´ Rate Limiting</h4>
        <ul>
          <li>Allowed vs rejected requests</li>
          <li>Top rate-limited endpoints</li>
        </ul>
      </div>
      <div class="metric-category">
        <h4>üõ°Ô∏è Security Events</h4>
        <ul>
          <li>Events by type</li>
          <li>Blocked requests by reason</li>
          <li>Top failed login IPs (24h table)</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Cache & Redis Dashboard -->
  <section class="doc-section">
    <h2 id="cache-dashboard">Cache & Redis Dashboard</h2>
    <p>Track caching effectiveness and Redis performance:</p>

    <div class="metrics-grid">
      <div class="metric-category">
        <h4>üì¶ Cache Overview</h4>
        <ul>
          <li>Cache Hit Rate (threshold: &lt;90% yellow, &lt;70% red)</li>
          <li>Cache Ops/sec</li>
          <li>Cache Entries count</li>
          <li>Cache Memory usage</li>
          <li>P95 Latency</li>
          <li>Evictions count</li>
        </ul>
      </div>
      <div class="metric-category">
        <h4>üîÑ Multi-Tier Caching</h4>
        <ul>
          <li>L1 vs L2 hit rates</li>
          <li>Operations by type (GET/SET/DELETE)</li>
        </ul>
      </div>
      <div class="metric-category">
        <h4>üî¥ Redis Metrics</h4>
        <ul>
          <li>Connection pool (active/idle)</li>
          <li>Command latency (p50/p95/p99)</li>
          <li>Top commands</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Queues & Jobs Dashboard -->
  <section class="doc-section">
    <h2 id="queue-dashboard">Queues & Jobs Dashboard</h2>
    <p>Monitor background job processing:</p>

    <div class="metrics-grid">
      <div class="metric-category">
        <h4>üìä Queue Overview</h4>
        <ul>
          <li>Pending Jobs (threshold: 100 yellow, 500 red)</li>
          <li>Processing Jobs</li>
          <li>Throughput (jobs/sec)</li>
          <li>Failure Rate (threshold: 1% yellow, 5% red)</li>
          <li>Dead Letter Queue</li>
          <li>Active Workers</li>
        </ul>
      </div>
      <div class="metric-category">
        <h4>‚è±Ô∏è Latency</h4>
        <ul>
          <li>Processing duration by job type</li>
          <li>Wait time (queue latency)</li>
        </ul>
      </div>
      <div class="metric-category">
        <h4>üîÑ Scheduled Tasks</h4>
        <ul>
          <li>Cron executions by task/status</li>
          <li>Task duration (P95)</li>
          <li>Retries by type</li>
          <li>Failures by error</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Docker Compose Setup -->
  <section class="doc-section">
    <h2 id="docker-compose">Docker Compose Setup</h2>
    <p>Full monitoring stack with Docker Compose:</p>

    <div class="code-block">
      <div class="code-header">
        <span class="code-lang">yaml</span>
        <span class="code-file">docker-compose.monitoring.yml</span>
      </div>
      <pre><code><span class="key">version</span>: <span class="string">'3.8'</span>

<span class="key">services</span>:
  <span class="key">prometheus</span>:
    <span class="key">image</span>: <span class="string">prom/prometheus:latest</span>
    <span class="key">volumes</span>:
      - <span class="string">./prometheus.yml:/etc/prometheus/prometheus.yml</span>
      - <span class="string">prometheus_data:/prometheus</span>
    <span class="key">ports</span>:
      - <span class="string">"9090:9090"</span>
    <span class="key">command</span>:
      - <span class="string">'--config.file=/etc/prometheus/prometheus.yml'</span>
      - <span class="string">'--storage.tsdb.retention.time=30d'</span>

  <span class="key">grafana</span>:
    <span class="key">image</span>: <span class="string">grafana/grafana:latest</span>
    <span class="key">volumes</span>:
      - <span class="string">grafana_data:/var/lib/grafana</span>
      - <span class="string">./templates/grafana:/var/lib/grafana/dashboards/armature</span>
      - <span class="string">./grafana-provisioning:/etc/grafana/provisioning</span>
    <span class="key">environment</span>:
      - <span class="string">GF_SECURITY_ADMIN_PASSWORD=admin</span>
    <span class="key">ports</span>:
      - <span class="string">"3001:3000"</span>
    <span class="key">depends_on</span>:
      - <span class="string">prometheus</span>

  <span class="key">your-app</span>:
    <span class="key">build</span>: <span class="string">.</span>
    <span class="key">ports</span>:
      - <span class="string">"3000:3000"</span>
    <span class="key">environment</span>:
      - <span class="string">METRICS_ENABLED=true</span>

<span class="key">volumes</span>:
  <span class="key">prometheus_data</span>:
  <span class="key">grafana_data</span>:</code></pre>
    </div>
  </section>

  <!-- Alert Thresholds -->
  <section class="doc-section">
    <h2 id="alerting">Setting Up Alerts</h2>
    <p>Configure Grafana alerts for critical thresholds:</p>

    <div class="table-wrapper">
      <table class="doc-table">
        <thead>
          <tr>
            <th>Metric</th>
            <th>Warning</th>
            <th>Critical</th>
          </tr>
        </thead>
        <tbody>
          @for (threshold of alertThresholds; track threshold.metric) {
            <tr>
              <td>{{ threshold.metric }}</td>
              <td class="warning">{{ threshold.warning }}</td>
              <td class="critical">{{ threshold.critical }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <p>To create alerts in Grafana:</p>
    <ol class="doc-steps">
      <li>Edit the panel you want to alert on</li>
      <li>Go to the <strong>Alert</strong> tab</li>
      <li>Click <strong>Create alert rule</strong></li>
      <li>Configure thresholds and notification channels</li>
    </ol>
  </section>

  <!-- Metric Reference -->
  <section class="doc-section">
    <h2 id="metrics">Metric Reference</h2>
    <p>These metric names are expected by the dashboards:</p>

    <div class="code-block">
      <div class="code-header">
        <span class="code-lang">text</span>
        <span class="code-file">HTTP Metrics</span>
      </div>
      <pre><code>http_requests_total&#123;method, status, endpoint&#125;
http_request_duration_seconds_bucket&#123;le, endpoint&#125;
http_connections_active</code></pre>
    </div>

    <div class="code-block">
      <div class="code-header">
        <span class="code-lang">text</span>
        <span class="code-file">Authentication Metrics</span>
      </div>
      <pre><code>auth_login_attempts_total&#123;status&#125;
auth_active_sessions
auth_jwt_tokens_issued_total
auth_jwt_validation_failures_total
auth_oauth_callbacks_total&#123;provider&#125;
ratelimit_requests_total&#123;status, endpoint&#125;</code></pre>
    </div>

    <div class="code-block">
      <div class="code-header">
        <span class="code-lang">text</span>
        <span class="code-file">Cache Metrics</span>
      </div>
      <pre><code>cache_hits_total&#123;tier&#125;
cache_misses_total&#123;tier&#125;
cache_operations_total&#123;operation&#125;
cache_entries_total
cache_memory_bytes
cache_evictions_total&#123;reason&#125;</code></pre>
    </div>

    <div class="code-block">
      <div class="code-header">
        <span class="code-lang">text</span>
        <span class="code-file">Queue Metrics</span>
      </div>
      <pre><code>queue_jobs_pending&#123;queue&#125;
queue_jobs_processing&#123;queue&#125;
queue_jobs_completed_total&#123;queue&#125;
queue_jobs_failed_total&#123;queue, error_type&#125;
queue_jobs_dead_letter&#123;queue&#125;
queue_workers_active</code></pre>
    </div>
  </section>

  <!-- Troubleshooting -->
  <section class="doc-section">
    <h2 id="troubleshooting">Troubleshooting</h2>

    <div class="doc-subsection">
      <h3>No Data Displayed</h3>
      <ol class="doc-steps">
        <li><strong>Verify metrics endpoint</strong> ‚Äî <code>curl http://your-app:3000/metrics</code></li>
        <li><strong>Check Prometheus targets</strong> ‚Äî Status ‚Üí Targets in Prometheus UI</li>
        <li><strong>Verify job label</strong> ‚Äî Ensure <code>$job</code> variable matches your prometheus.yml</li>
        <li><strong>Check data source</strong> ‚Äî Test connection in Grafana data sources</li>
      </ol>
    </div>

    <div class="doc-subsection">
      <h3>Missing Metrics</h3>
      <p>Enable the features that expose the metrics you need:</p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">rust</span>
        </div>
        <pre><code><span class="comment">// Enable all features that export metrics</span>
<span class="keyword">let</span> app = Application::builder()
    .metrics(MetricsConfig::default())      <span class="comment">// HTTP metrics</span>
    .cache(CacheConfig::default())          <span class="comment">// Cache metrics</span>
    .queue(QueueConfig::default())          <span class="comment">// Queue metrics</span>
    .auth(AuthConfig::default())            <span class="comment">// Auth metrics</span>
    .build();</code></pre>
      </div>
    </div>
  </section>

  <!-- Related Docs -->
  <section class="doc-section doc-related">
    <h2>Related Documentation</h2>
    <div class="related-grid">
      <a [routerLink]="['/docs', 'metrics-guide']" class="related-card">
        <span class="related-icon">üìà</span>
        <div>
          <h4>Prometheus Metrics</h4>
          <p>Configure metrics export in your application</p>
        </div>
      </a>
      <a [routerLink]="['/docs', 'health-check']" class="related-card">
        <span class="related-icon">üíö</span>
        <div>
          <h4>Health Checks</h4>
          <p>Kubernetes-ready health probes</p>
        </div>
      </a>
      <a [routerLink]="['/docs', 'opentelemetry-guide']" class="related-card">
        <span class="related-icon">üî≠</span>
        <div>
          <h4>OpenTelemetry</h4>
          <p>Distributed tracing and observability</p>
        </div>
      </a>
    </div>
  </section>

  <!-- See Also -->
  <section class="doc-section doc-see-also">
    <h3>See Also</h3>
    <ul class="see-also-list">
      <li><a [routerLink]="['/docs', 'logging-guide']">Logging Guide</a></li>
      <li><a [routerLink]="['/docs', 'error-correlation']">Error Tracking</a></li>
      <li><a [routerLink]="['/docs', 'docker-guide']">Docker Deployment</a></li>
    </ul>
  </section>
</article>

